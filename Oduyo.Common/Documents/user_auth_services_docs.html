<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Servis KatmanÄ± KullanÄ±m DokÃ¼mantasyonu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        nav {
            background: #2c3e50;
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        nav a:hover {
            color: #3498db;
        }
        
        main {
            padding: 2rem;
        }
        
        section {
            margin-bottom: 3rem;
        }
        
        h2 {
            color: #667eea;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid #667eea;
        }
        
        h3 {
            color: #764ba2;
            font-size: 1.4rem;
            margin: 1.5rem 0 1rem;
        }
        
        h4 {
            color: #555;
            font-size: 1.1rem;
            margin: 1rem 0 0.5rem;
        }
        
        pre {
            background: #282c34;
            color: #abb2bf;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            border-left: 4px solid #667eea;
        }
        
        code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .keyword { color: #c678dd; }
        .string { color: #98c379; }
        .comment { color: #5c6370; font-style: italic; }
        .method { color: #61afef; }
        .type { color: #e5c07b; }
        .number { color: #d19a66; }
        
        .platform-tabs {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
            border-bottom: 2px solid #eee;
        }
        
        .platform-tab {
            padding: 0.75rem 1.5rem;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-weight: 600;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s;
        }
        
        .platform-tab:hover {
            background: #e9ecef;
        }
        
        .platform-tab.active {
            background: #667eea;
            color: white;
        }
        
        .platform-content {
            display: none;
        }
        
        .platform-content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        th {
            background: #667eea;
            color: white;
            padding: 1rem;
            text-align: left;
        }
        
        td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .note {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        
        ul {
            margin: 1rem 0;
            padding-left: 2rem;
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: 3rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“š Servis KatmanÄ± KullanÄ±m DokÃ¼mantasyonu</h1>
            <p>Web API â€¢ Blazor â€¢ WinForms â€¢ Mobile iÃ§in Servis KullanÄ±mÄ±</p>
        </header>
        
        <nav>
            <ul>
                <li><a href="#user-service">UserService</a></li>
                <li><a href="#role-service">RoleService</a></li>
                <li><a href="#permission-service">PermissionService</a></li>
                <li><a href="#hierarchy-service">UserHierarchyService</a></li>
                <li><a href="#discount-service">DiscountAuthorityService</a></li>
            </ul>
        </nav>
        
        <main>
            <section id="user-service">
                <h2>ğŸ‘¤ IUserService</h2>
                
                <h3>KullanÄ±cÄ± OluÅŸturma - CreateUserAsync</h3>
                
                <div class="platform-tabs">
                    <button class="platform-tab active" onclick="showPlatform('user-create', 'webapi')">Web API</button>
                    <button class="platform-tab" onclick="showPlatform('user-create', 'blazor')">Blazor</button>
                    <button class="platform-tab" onclick="showPlatform('user-create', 'winforms')">WinForms</button>
                    <button class="platform-tab" onclick="showPlatform('user-create', 'mobile')">Mobile</button>
                </div>
                
                <div id="user-create-webapi" class="platform-content active">
                    <h4>Web API Controller</h4>
                    <pre><code>[<span class="type">HttpPost</span>]
<span class="keyword">public async</span> Task&lt;IActionResult&gt; <span class="method">CreateUser</span>([FromBody] CreateUserDto dto)
{
    <span class="keyword">var</span> currentUserId = <span class="keyword">int</span>.Parse(User.FindFirst(ClaimTypes.NameIdentifier).Value);
    
    <span class="keyword">var</span> result = <span class="keyword">await</span> _userService.CreateUserAsync(dto, currentUserId);
    
    <span class="keyword">if</span> (result.Succeeded)
        <span class="keyword">return</span> Ok(<span class="keyword">new</span> { message = <span class="string">"KullanÄ±cÄ± oluÅŸturuldu"</span> });
        
    <span class="keyword">return</span> BadRequest(result.Errors);
}</code></pre>
                </div>
                
                <div id="user-create-blazor" class="platform-content">
                    <h4>Blazor Component</h4>
                    <pre><code>@inject IUserService UserService
@inject AuthenticationStateProvider AuthStateProvider

<span class="keyword">private async</span> Task <span class="method">CreateUser</span>()
{
    <span class="keyword">var</span> authState = <span class="keyword">await</span> AuthStateProvider.GetAuthenticationStateAsync();
    <span class="keyword">var</span> currentUserId = <span class="keyword">int</span>.Parse(authState.User.FindFirst(ClaimTypes.NameIdentifier).Value);
    
    <span class="keyword">var</span> dto = <span class="keyword">new</span> CreateUserDto
    {
        FirstName = firstName,
        LastName = lastName,
        Email = email,
        Phone = phone,
        Password = password,
        UserType = selectedUserType
    };
    
    <span class="keyword">var</span> result = <span class="keyword">await</span> UserService.CreateUserAsync(dto, currentUserId);
    
    <span class="keyword">if</span> (result.Succeeded)
    {
        <span class="keyword">await</span> JSRuntime.InvokeVoidAsync(<span class="string">"alert"</span>, <span class="string">"KullanÄ±cÄ± oluÅŸturuldu"</span>);
        NavigationManager.NavigateTo(<span class="string">"/users"</span>);
    }
    <span class="keyword">else</span>
    {
        errorMessage = <span class="keyword">string</span>.Join(<span class="string">", "</span>, result.Errors.Select(e => e.Description));
    }
}</code></pre>
                </div>
                
                <div id="user-create-winforms" class="platform-content">
                    <h4>WinForms</h4>
                    <pre><code><span class="keyword">private readonly</span> IUserService _userService;
<span class="keyword">private readonly int</span> _currentUserId;

<span class="keyword">private async void</span> <span class="method">btnCreateUser_Click</span>(<span class="keyword">object</span> sender, EventArgs e)
{
    <span class="keyword">var</span> dto = <span class="keyword">new</span> CreateUserDto
    {
        FirstName = txtFirstName.Text,
        LastName = txtLastName.Text,
        Email = txtEmail.Text,
        Phone = txtPhone.Text,
        Password = txtPassword.Text,
        UserType = (UserType)cmbUserType.SelectedValue
    };
    
    <span class="keyword">var</span> result = <span class="keyword">await</span> _userService.CreateUserAsync(dto, _currentUserId);
    
    <span class="keyword">if</span> (result.Succeeded)
    {
        MessageBox.Show(<span class="string">"KullanÄ±cÄ± baÅŸarÄ±yla oluÅŸturuldu"</span>, <span class="string">"BaÅŸarÄ±lÄ±"</span>, MessageBoxButtons.OK, MessageBoxIcon.Information);
        <span class="keyword">this</span>.Close();
    }
    <span class="keyword">else</span>
    {
        <span class="keyword">var</span> errors = <span class="keyword">string</span>.Join(<span class="string">"\n"</span>, result.Errors.Select(e => e.Description));
        MessageBox.Show(errors, <span class="string">"Hata"</span>, MessageBoxButtons.OK, MessageBoxIcon.Error);
    }
}</code></pre>
                </div>
                
                <div id="user-create-mobile" class="platform-content">
                    <h4>Mobile (MAUI/Xamarin)</h4>
                    <pre><code><span class="keyword">private readonly</span> IUserService _userService;
<span class="keyword">private readonly int</span> _currentUserId;

<span class="keyword">private async</span> Task <span class="method">CreateUser</span>()
{
    <span class="keyword">var</span> dto = <span class="keyword">new</span> CreateUserDto
    {
        FirstName = FirstName,
        LastName = LastName,
        Email = Email,
        Phone = Phone,
        Password = Password,
        UserType = SelectedUserType
    };
    
    <span class="keyword">var</span> result = <span class="keyword">await</span> _userService.CreateUserAsync(dto, _currentUserId);
    
    <span class="keyword">if</span> (result.Succeeded)
    {
        <span class="keyword">await</span> Application.Current.MainPage.DisplayAlert(<span class="string">"BaÅŸarÄ±lÄ±"</span>, <span class="string">"KullanÄ±cÄ± oluÅŸturuldu"</span>, <span class="string">"Tamam"</span>);
        <span class="keyword">await</span> Shell.Current.GoToAsync(<span class="string">".."</span>);
    }
    <span class="keyword">else</span>
    {
        <span class="keyword">var</span> errors = <span class="keyword">string</span>.Join(<span class="string">"\n"</span>, result.Errors.Select(e => e.Description));
        <span class="keyword">await</span> Application.Current.MainPage.DisplayAlert(<span class="string">"Hata"</span>, errors, <span class="string">"Tamam"</span>);
    }
}</code></pre>
                </div>

                <h3>KullanÄ±cÄ± GÃ¼ncelleme - UpdateUserAsync</h3>
                <pre><code><span class="comment">// TÃ¼m platformlarda aynÄ± kullanÄ±m</span>
<span class="keyword">var</span> dto = <span class="keyword">new</span> UpdateUserDto
{
    FirstName = <span class="string">"Ahmet"</span>,
    LastName = <span class="string">"YÄ±lmaz"</span>,
    Phone = <span class="string">"5551234567"</span>,
    IsActive = <span class="keyword">true</span>
};

<span class="keyword">var</span> result = <span class="keyword">await</span> _userService.UpdateUserAsync(userId, dto, currentUserId);</code></pre>

                <h3>KullanÄ±cÄ± Silme - DeleteUserAsync</h3>
                <pre><code><span class="comment">// Soft delete</span>
<span class="keyword">var</span> result = <span class="keyword">await</span> _userService.DeleteUserAsync(userId, currentUserId);

<span class="keyword">if</span> (result.Succeeded)
{
    <span class="comment">// BaÅŸarÄ±lÄ±</span>
}</code></pre>

                <h3>KullanÄ±cÄ± Getirme Ä°ÅŸlemleri</h3>
                <pre><code><span class="comment">// ID ile kullanÄ±cÄ± getir</span>
<span class="keyword">var</span> user = <span class="keyword">await</span> _userService.GetUserByIdAsync(userId);

<span class="comment">// Email ile kullanÄ±cÄ± getir</span>
<span class="keyword">var</span> user = <span class="keyword">await</span> _userService.GetUserByEmailAsync(<span class="string">"ahmet@example.com"</span>);

<span class="comment">// Tipe gÃ¶re kullanÄ±cÄ±larÄ± getir</span>
<span class="keyword">var</span> backofficeUsers = <span class="keyword">await</span> _userService.GetUsersByTypeAsync(UserType.Backoffice);
<span class="keyword">var</span> tenantUsers = <span class="keyword">await</span> _userService.GetUsersByTypeAsync(UserType.Tenant);
<span class="keyword">var</span> dealerUsers = <span class="keyword">await</span> _userService.GetUsersByTypeAsync(UserType.Dealer);

<span class="comment">// TÃ¼m kullanÄ±cÄ±larÄ± getir</span>
<span class="keyword">var</span> allUsers = <span class="keyword">await</span> _userService.GetAllUsersAsync();</code></pre>

                <h3>Åifre Ä°ÅŸlemleri</h3>
                <pre><code><span class="comment">// Åifre kontrolÃ¼</span>
<span class="keyword">var</span> isPasswordValid = <span class="keyword">await</span> _userService.CheckPasswordAsync(user, password);

<span class="comment">// Åifre deÄŸiÅŸtirme</span>
<span class="keyword">var</span> result = <span class="keyword">await</span> _userService.ChangePasswordAsync(
    userId, 
    <span class="string">"EskiSifre123!"</span>, 
    <span class="string">"YeniSifre123!"</span>
);</code></pre>
            </section>

            <section id="role-service">
                <h2>ğŸ­ IRoleService</h2>
                
                <h3>Rol OluÅŸturma - CreateRoleAsync</h3>
                <pre><code><span class="keyword">var</span> dto = <span class="keyword">new</span> CreateRoleDto
{
    Name = <span class="string">"SatÄ±ÅŸ Temsilcisi"</span>,
    Description = <span class="string">"SatÄ±ÅŸ iÅŸlemlerini yÃ¶netir"</span>,
    RoleType = RoleType.Backoffice
};

<span class="keyword">var</span> result = <span class="keyword">await</span> _roleService.CreateRoleAsync(dto, currentUserId);</code></pre>

                <h3>Rol GÃ¼ncelleme - UpdateRoleAsync</h3>
                <pre><code><span class="keyword">var</span> dto = <span class="keyword">new</span> UpdateRoleDto
{
    Name = <span class="string">"KÄ±demli SatÄ±ÅŸ Temsilcisi"</span>,
    Description = <span class="string">"SatÄ±ÅŸ iÅŸlemlerini yÃ¶netir ve ekip liderliÄŸi yapar"</span>,
    IsActive = <span class="keyword">true</span>
};

<span class="keyword">var</span> result = <span class="keyword">await</span> _roleService.UpdateRoleAsync(roleId, dto, currentUserId);</code></pre>

                <h3>KullanÄ±cÄ±ya Rol Atama/KaldÄ±rma</h3>
                <pre><code><span class="comment">// Rol atama</span>
<span class="keyword">var</span> result = <span class="keyword">await</span> _roleService.AssignRoleToUserAsync(userId, roleId);

<span class="comment">// Rol kaldÄ±rma</span>
<span class="keyword">var</span> result = <span class="keyword">await</span> _roleService.RemoveRoleFromUserAsync(userId, roleId);</code></pre>

                <h3>Rol Listeleme</h3>
                <pre><code><span class="comment">// TÃ¼m rolleri getir</span>
<span class="keyword">var</span> allRoles = <span class="keyword">await</span> _roleService.GetAllRolesAsync();

<span class="comment">// Tipe gÃ¶re rolleri getir</span>
<span class="keyword">var</span> backofficeRoles = <span class="keyword">await</span> _roleService.GetRolesByTypeAsync(RoleType.Backoffice);
<span class="keyword">var</span> tenantRoles = <span class="keyword">await</span> _roleService.GetRolesByTypeAsync(RoleType.Tenant);

<span class="comment">// KullanÄ±cÄ±nÄ±n rollerini getir</span>
<span class="keyword">var</span> userRoles = <span class="keyword">await</span> _roleService.GetUserRolesAsync(userId);</code></pre>

                <div class="note">
                    <strong>ğŸ’¡ Ã–rnek KullanÄ±m - Blazor:</strong>
                    <pre><code>@inject IRoleService RoleService

&lt;select @bind="selectedRoleId"&gt;
    @foreach (var role in roles)
    {
        &lt;option value="@role.Id"&gt;@role.Name&lt;/option&gt;
    }
&lt;/select&gt;

@code {
    <span class="keyword">private</span> List&lt;Role&gt; roles;
    <span class="keyword">private int</span> selectedRoleId;
    
    <span class="keyword">protected override async</span> Task <span class="method">OnInitializedAsync</span>()
    {
        roles = <span class="keyword">await</span> RoleService.GetAllRolesAsync();
    }
}</code></pre>
                </div>
            </section>

            <section id="permission-service">
                <h2>ğŸ”‘ IPermissionService</h2>
                
                <h3>Ä°zin OluÅŸturma - CreatePermissionAsync</h3>
                <pre><code><span class="keyword">var</span> dto = <span class="keyword">new</span> CreatePermissionDto
{
    Name = <span class="string">"Firma OluÅŸturma"</span>,
    Code = <span class="string">"company.create"</span>,
    Module = <span class="string">"Firmalar"</span>,
    Description = <span class="string">"Yeni firma kaydÄ± oluÅŸturabilir"</span>
};

<span class="keyword">var</span> permission = <span class="keyword">await</span> _permissionService.CreatePermissionAsync(dto, currentUserId);</code></pre>

                <h3>Ä°zin GÃ¼ncelleme - UpdatePermissionAsync</h3>
                <pre><code><span class="keyword">var</span> dto = <span class="keyword">new</span> UpdatePermissionDto
{
    Name = <span class="string">"Firma Ekleme"</span>,
    Description = <span class="string">"Yeni firma kaydÄ± ekleyebilir"</span>,
    IsActive = <span class="keyword">true</span>
};

<span class="keyword">var</span> permission = <span class="keyword">await</span> _permissionService.UpdatePermissionAsync(permissionId, dto, currentUserId);</code></pre>

                <h3>Role Ä°zin Atama/KaldÄ±rma</h3>
                <pre><code><span class="comment">// Role izin atama</span>
<span class="keyword">var</span> success = <span class="keyword">await</span> _permissionService.AssignPermissionToRoleAsync(roleId, permissionId, currentUserId);

<span class="comment">// Rolden izin kaldÄ±rma</span>
<span class="keyword">var</span> success = <span class="keyword">await</span> _permissionService.RemovePermissionFromRoleAsync(roleId, permissionId, currentUserId);</code></pre>

                <h3>Ä°zin Listeleme</h3>
                <pre><code><span class="comment">// TÃ¼m izinleri getir</span>
<span class="keyword">var</span> allPermissions = <span class="keyword">await</span> _permissionService.GetAllPermissionsAsync();

<span class="comment">// ModÃ¼le gÃ¶re izinleri getir</span>
<span class="keyword">var</span> companyPermissions = <span class="keyword">await</span> _permissionService.GetPermissionsByModuleAsync(<span class="string">"Firmalar"</span>);

<span class="comment">// RolÃ¼n izinlerini getir</span>
<span class="keyword">var</span> rolePermissions = <span class="keyword">await</span> _permissionService.GetRolePermissionsAsync(roleId);</code></pre>

                <h3>KullanÄ±cÄ± Ä°zin KontrolÃ¼ - UserHasPermissionAsync</h3>
                <pre><code><span class="comment">// KullanÄ±cÄ±nÄ±n belirli bir izni var mÄ± kontrol et</span>
<span class="keyword">var</span> hasPermission = <span class="keyword">await</span> _permissionService.UserHasPermissionAsync(userId, <span class="string">"company.create"</span>);

<span class="keyword">if</span> (hasPermission)
{
    <span class="comment">// Ä°ÅŸleme izin ver</span>
}
<span class="keyword">else</span>
{
    <span class="comment">// Yetkisiz eriÅŸim</span>
}</code></pre>

                <div class="success">
                    <strong>âœ“ Ã–rnek KullanÄ±m - WinForms Button Enable/Disable:</strong>
                    <pre><code><span class="keyword">private async void</span> <span class="method">LoadPermissions</span>()
{
    btnCreateCompany.Enabled = <span class="keyword">await</span> _permissionService.UserHasPermissionAsync(_currentUserId, <span class="string">"company.create"</span>);
    btnEditCompany.Enabled = <span class="keyword">await</span> _permissionService.UserHasPermissionAsync(_currentUserId, <span class="string">"company.update"</span>);
    btnDeleteCompany.Enabled = <span class="keyword">await</span> _permissionService.UserHasPermissionAsync(_currentUserId, <span class="string">"company.delete"</span>);
}</code></pre>
                </div>

                <div class="success">
                    <strong>âœ“ Ã–rnek KullanÄ±m - Blazor Component:</strong>
                    <pre><code>@inject IPermissionService PermissionService

@if (canCreate)
{
    &lt;button @onclick="CreateCompany"&gt;Firma OluÅŸtur&lt;/button&gt;
}

@code {
    <span class="keyword">private bool</span> canCreate;
    
    <span class="keyword">protected override async</span> Task <span class="method">OnInitializedAsync</span>()
    {
        <span class="keyword">var</span> authState = <span class="keyword">await</span> AuthStateProvider.GetAuthenticationStateAsync();
        <span class="keyword">var</span> userId = <span class="keyword">int</span>.Parse(authState.User.FindFirst(ClaimTypes.NameIdentifier).Value);
        
        canCreate = <span class="keyword">await</span> PermissionService.UserHasPermissionAsync(userId, <span class="string">"company.create"</span>);
    }
}</code></pre>
                </div>
            </section>

            <section id="hierarchy-service">
                <h2>ğŸŒ³ IUserHierarchyService</h2>
                
                <h3>HiyerarÅŸi OluÅŸturma - CreateHierarchyAsync</h3>
                <pre><code><span class="comment">// Alt kullanÄ±cÄ± iliÅŸkisi oluÅŸtur</span>
<span class="keyword">var</span> hierarchy = <span class="keyword">await</span> _userHierarchyService.CreateHierarchyAsync(
    parentUserId: <span class="number">5</span>, 
    childUserId: <span class="number">12</span>, 
    createdBy: currentUserId
);

<span class="keyword">if</span> (hierarchy != <span class="keyword">null</span>)
{
    <span class="comment">// HiyerarÅŸi baÅŸarÄ±yla oluÅŸturuldu</span>
}</code></pre>

                <h3>HiyerarÅŸi Silme - DeleteHierarchyAsync</h3>
                <pre><code><span class="keyword">var</span> success = <span class="keyword">await</span> _userHierarchyService.DeleteHierarchyAsync(hierarchyId, currentUserId);</code></pre>

                <h3>Alt KullanÄ±cÄ±larÄ± Getirme - GetChildUsersAsync</h3>
                <pre><code><span class="comment">// Bir kullanÄ±cÄ±nÄ±n tÃ¼m alt kullanÄ±cÄ±larÄ±nÄ± getir</span>
<span class="keyword">var</span> childUsers = <span class="keyword">await</span> _userHierarchyService.GetChildUsersAsync(parentUserId);

<span class="keyword">foreach</span> (<span class="keyword">var</span> child <span class="keyword">in</span> childUsers)
{
    Console.WriteLine(<span class="string">$"Alt KullanÄ±cÄ±: {child.FirstName} {child.LastName}"</span>);
}</code></pre>

                <h3>Ãœst KullanÄ±cÄ±yÄ± Getirme - GetParentUserAsync</h3>
                <pre><code><span class="comment">// Bir kullanÄ±cÄ±nÄ±n Ã¼st kullanÄ±cÄ±sÄ±nÄ± getir</span>
<span class="keyword">var</span> parent = <span class="keyword">await</span> _userHierarchyService.GetParentUserAsync(childUserId);

<span class="keyword">if</span> (parent != <span class="keyword">null</span>)
{
    Console.WriteLine(<span class="string">$"Ãœst KullanÄ±cÄ±: {parent.FirstName} {parent.LastName}"</span>);
}</code></pre>

                <h3>HiyerarÅŸi KontrolÃ¼ - IsUserChildOfAsync</h3>
                <pre><code><span class="comment">// Bir kullanÄ±cÄ± baÅŸka bir kullanÄ±cÄ±nÄ±n alt kullanÄ±cÄ±sÄ± mÄ±?</span>
<span class="keyword">var</span> isChild = <span class="keyword">await</span> _userHierarchyService.IsUserChildOfAsync(parentUserId, childUserId);

<span class="keyword">if</span> (isChild)
{
    <span class="comment">// KullanÄ±cÄ±, belirtilen kullanÄ±cÄ±nÄ±n alt kullanÄ±cÄ±sÄ±dÄ±r</span>
}</code></pre>

                <div class="note">
                    <strong>ğŸ’¡ KullanÄ±m Senaryosu - Tenant KullanÄ±cÄ±larÄ±:</strong>
                    <pre><code><span class="comment">// Ã–rnek: Bir tenant kullanÄ±cÄ±sÄ±nÄ±n altÄ±nda birden fazla alt kullanÄ±cÄ± var</span>
<span class="keyword">var</span> mainTenantUser = <span class="keyword">await</span> _userService.GetUserByIdAsync(<span class="number">10</span>);

<span class="comment">// Ana kullanÄ±cÄ±nÄ±n altÄ±na 3 alt kullanÄ±cÄ± ekle</span>
<span class="keyword">await</span> _userHierarchyService.CreateHierarchyAsync(<span class="number">10</span>, <span class="number">11</span>, currentUserId);
<span class="keyword">await</span> _userHierarchyService.CreateHierarchyAsync(<span class="number">10</span>, <span class="number">12</span>, currentUserId);
<span class="keyword">await</span> _userHierarchyService.CreateHierarchyAsync(<span class="number">10</span>, <span class="number">13</span>, currentUserId);

<span class="comment">// Ana kullanÄ±cÄ±nÄ±n tÃ¼m alt kullanÄ±cÄ±larÄ±nÄ± listele</span>
<span class="keyword">var</span> subUsers = <span class="keyword">await</span> _userHierarchyService.GetChildUsersAsync(<span class="number">10</span>);
<span class="comment">// subUsers.Count = 3</span></code></pre>
                </div>

                <div class="warning">
                    <strong>âš ï¸ Ã–nemli Not:</strong> Bir kullanÄ±cÄ±nÄ±n sadece bir Ã¼st kullanÄ±cÄ±sÄ± olabilir ancak birden fazla alt kullanÄ±cÄ±sÄ± olabilir.
                </div>
            </section>

            <section id="discount-service">
                <h2>ğŸ’° IDiscountAuthorityService</h2>
                
                <h3>Ä°ndirim Yetkisi OluÅŸturma - CreateAuthorityAsync</h3>
                <pre><code><span class="keyword">var</span> dto = <span class="keyword">new</span> CreateDiscountAuthorityDto
{
    UserId = <span class="number">5</span>,
    MaxDiscountRate = <span class="number">15.50m</span>
};

<span class="keyword">var</span> authority = <span class="keyword">await</span> _discountAuthorityService.CreateAuthorityAsync(dto, currentUserId);

<span class="keyword">if</span> (authority != <span class="keyword">null</span>)
{
    <span class="comment">// Ä°ndirim yetkisi baÅŸarÄ±yla tanÄ±mlandÄ±</span>
}</code></pre>

                <h3>Ä°ndirim Yetkisi GÃ¼ncelleme - UpdateAuthorityAsync</h3>
                <pre><code><span class="keyword">var</span> dto = <span class="keyword">new</span> UpdateDiscountAuthorityDto
{
    MaxDiscountRate = <span class="number">20.00m</span>,
    IsActive = <span class="keyword">true</span>
};

<span class="keyword">var</span> authority = <span class="keyword">await</span> _discountAuthorityService.UpdateAuthorityAsync(authorityId, dto, currentUserId);</code></pre>

                <h3>KullanÄ±cÄ±nÄ±n Ä°ndirim Yetkisini Getirme - GetUserDiscountAuthorityAsync</h3>
                <pre><code><span class="keyword">var</span> authority = <span class="keyword">await</span> _discountAuthorityService.GetUserDiscountAuthorityAsync(userId);

<span class="keyword">if</span> (authority != <span class="keyword">null</span>)
{
    Console.WriteLine(<span class="string">$"Maksimum Ä°ndirim OranÄ±: %{authority.MaxDiscountRate}"</span>);
}</code></pre>

                <h3>Ä°ndirim Yetkisi KontrolÃ¼ - CanUserApplyDiscountAsync</h3>
                <pre><code><span class="comment">// KullanÄ±cÄ± belirli bir indirim oranÄ±nÄ± uygulayabilir mi?</span>
<span class="keyword">var</span> canApply = <span class="keyword">await</span> _discountAuthorityService.CanUserApplyDiscountAsync(userId, <span class="number">12.5m</span>);

<span class="keyword">if</span> (canApply)
{
    <span class="comment">// Ä°ndirim uygulanabilir</span>
}
<span class="keyword">else</span>
{
    <span class="comment">// Ä°ndirim yetkisi aÅŸÄ±lÄ±yor, Ã¼st yÃ¶netim onayÄ± gerekli</span>
}</code></pre>

                <div class="success">
                    <strong>âœ“ GerÃ§ek Senaryo - Teklif OluÅŸturma:</strong>
                    <pre><code><span class="comment">// Web API Controller</span>
[<span class="type">HttpPost</span>(<span class="string">"offers"</span>)]
<span class="keyword">public async</span> Task&lt;IActionResult&gt; <span class="method">CreateOffer</span>([FromBody] CreateOfferDto dto)
{
    <span class="keyword">var</span> currentUserId = <span class="keyword">int</span>.Parse(User.FindFirst(ClaimTypes.NameIdentifier).Value);
    
    <span class="comment">// Ä°ndirim kontrolÃ¼</span>
    <span class="keyword">if</span> (dto.DiscountRate > <span class="number">0</span>)
    {
        <span class="keyword">var</span> canApply = <span class="keyword">await</span> _discountAuthorityService.CanUserApplyDiscountAsync(
            currentUserId, 
            dto.DiscountRate
        );
        
        <span class="keyword">if</span> (!canApply)
        {
            <span class="comment">// Ãœst yÃ¶netim onayÄ±na gÃ¶nder</span>
            <span class="keyword">var</span> approval = <span class="keyword">new</span> OfferApproval
            {
                OfferId = offer.Id,
                RequestedUserId = currentUserId,
                ApproverUserId = GetManagerUserId(),
                IsApproved = <span class="keyword">false</span>
            };
            
            <span class="keyword">await</span> _context.OfferApprovals.AddAsync(approval);
            <span class="keyword">await</span> _context.SaveChangesAsync();
            
            <span class="keyword">return</span> Ok(<span class="keyword">new</span> { 
                message = <span class="string">"Ä°ndirim yetkiniz bu oranÄ± aÅŸÄ±yor. Onay iÃ§in yÃ¶neticinize iletildi."</span>,
                requiresApproval = <span class="keyword">true</span>
            });
        }
    }
    
    <span class="comment">// Teklif oluÅŸturma iÅŸlemine devam et</span>
    <span class="comment">// ...</span>
}</code></pre>
                </div>

                <div class="success">
                    <strong>âœ“ WinForms Ã–rneÄŸi - Dinamik Ä°ndirim KontrolÃ¼:</strong>
                    <pre><code><span class="keyword">private async void</span> <span class="method">txtDiscountRate_TextChanged</span>(<span class="keyword">object</span> sender, EventArgs e)
{
    <span class="keyword">if</span> (<span class="keyword">decimal</span>.TryParse(txtDiscountRate.Text, <span class="keyword">out decimal</span> discountRate))
    {
        <span class="keyword">var</span> canApply = <span class="keyword">await</span> _discountAuthorityService.CanUserApplyDiscountAsync(
            _currentUserId, 
            discountRate
        );
        
        <span class="keyword">if</span> (canApply)
        {
            lblDiscountWarning.Text = <span class="string">"âœ“ Ä°ndirim uygulanabilir"</span>;
            lblDiscountWarning.ForeColor = Color.Green;
            btnCreateOffer.Enabled = <span class="keyword">true</span>;
        }
        <span class="keyword">else</span>
        {
            lblDiscountWarning.Text = <span class="string">"âš  Ä°ndirim yetkinizi aÅŸÄ±yor. YÃ¶netici onayÄ± gerekli."</span>;
            lblDiscountWarning.ForeColor = Color.Orange;
            btnCreateOffer.Enabled = <span class="keyword">false</span>;
        }
    }
}</code></pre>
                </div>

                <div class="success">
                    <strong>âœ“ Blazor Ã–rneÄŸi - GerÃ§ek ZamanlÄ± Ä°ndirim KontrolÃ¼:</strong>
                    <pre><code>@inject IDiscountAuthorityService DiscountService

&lt;input type="number" @bind="discountRate" @bind:event="oninput" /&gt;

@if (showWarning)
{
    &lt;div class="alert alert-warning"&gt;
        âš  Ä°ndirim yetkinizi aÅŸÄ±yor. YÃ¶netici onayÄ± gerekli.
    &lt;/div&gt;
}
else if (discountRate > 0)
{
    &lt;div class="alert alert-success"&gt;
        âœ“ Ä°ndirim uygulanabilir
    &lt;/div&gt;
}

@code {
    <span class="keyword">private decimal</span> discountRate;
    <span class="keyword">private bool</span> showWarning;
    <span class="keyword">private int</span> currentUserId;
    
    <span class="keyword">protected override async</span> Task <span class="method">OnParametersSetAsync</span>()
    {
        <span class="keyword">if</span> (discountRate > <span class="number">0</span>)
        {
            <span class="keyword">var</span> canApply = <span class="keyword">await</span> DiscountService.CanUserApplyDiscountAsync(currentUserId, discountRate);
            showWarning = !canApply;
        }
    }
}</code></pre>
                </div>
            </section>

            <section>
                <h2>ğŸ“‹ Servis Ã–zet Tablosu</h2>
                
                <table>
                    <thead>
                        <tr>
                            <th>Servis</th>
                            <th>Metod</th>
                            <th>AÃ§Ä±klama</th>
                            <th>DÃ¶nÃ¼ÅŸ Tipi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td rowspan="8"><strong>IUserService</strong></td>
                            <td>CreateUserAsync</td>
                            <td>Yeni kullanÄ±cÄ± oluÅŸturur</td>
                            <td>Task&lt;IdentityResult&gt;</td>
                        </tr>
                        <tr>
                            <td>UpdateUserAsync</td>
                            <td>KullanÄ±cÄ± bilgilerini gÃ¼nceller</td>
                            <td>Task&lt;IdentityResult&gt;</td>
                        </tr>
                        <tr>
                            <td>DeleteUserAsync</td>
                            <td>KullanÄ±cÄ±yÄ± siler (soft delete)</td>
                            <td>Task&lt;IdentityResult&gt;</td>
                        </tr>
                        <tr>
                            <td>GetUserByIdAsync</td>
                            <td>ID ile kullanÄ±cÄ± getirir</td>
                            <td>Task&lt;User&gt;</td>
                        </tr>
                        <tr>
                            <td>GetUserByEmailAsync</td>
                            <td>Email ile kullanÄ±cÄ± getirir</td>
                            <td>Task&lt;User&gt;</td>
                        </tr>
                        <tr>
                            <td>GetUsersByTypeAsync</td>
                            <td>Tipe gÃ¶re kullanÄ±cÄ±larÄ± getirir</td>
                            <td>Task&lt;List&lt;User&gt;&gt;</td>
                        </tr>
                        <tr>
                            <td>CheckPasswordAsync</td>
                            <td>Åifre doÄŸrulamasÄ± yapar</td>
                            <td>Task&lt;bool&gt;</td>
                        </tr>
                        <tr>
                            <td>ChangePasswordAsync</td>
                            <td>KullanÄ±cÄ± ÅŸifresini deÄŸiÅŸtirir</td>
                            <td>Task&lt;IdentityResult&gt;</td>
                        </tr>
                        
                        <tr>
                            <td rowspan="7"><strong>IRoleService</strong></td>
                            <td>CreateRoleAsync</td>
                            <td>Yeni rol oluÅŸturur</td>
                            <td>Task&lt;IdentityResult&gt;</td>
                        </tr>
                        <tr>
                            <td>UpdateRoleAsync</td>
                            <td>Rol bilgilerini gÃ¼nceller</td>
                            <td>Task&lt;IdentityResult&gt;</td>
                        </tr>
                        <tr>
                            <td>DeleteRoleAsync</td>
                            <td>RolÃ¼ siler (soft delete)</td>
                            <td>Task&lt;IdentityResult&gt;</td>
                        </tr>
                        <tr>
                            <td>AssignRoleToUserAsync</td>
                            <td>KullanÄ±cÄ±ya rol atar</td>
                            <td>Task&lt;IdentityResult&gt;</td>
                        </tr>
                        <tr>
                            <td>RemoveRoleFromUserAsync</td>
                            <td>KullanÄ±cÄ±dan rol kaldÄ±rÄ±r</td>
                            <td>Task&lt;IdentityResult&gt;</td>
                        </tr>
                        <tr>
                            <td>GetRolesByTypeAsync</td>
                            <td>Tipe gÃ¶re rolleri getirir</td>
                            <td>Task&lt;List&lt;Role&gt;&gt;</td>
                        </tr>
                        <tr>
                            <td>GetUserRolesAsync</td>
                            <td>KullanÄ±cÄ±nÄ±n rollerini getirir</td>
                            <td>Task&lt;List&lt;Role&gt;&gt;</td>
                        </tr>
                        
                        <tr>
                            <td rowspan="7"><strong>IPermissionService</strong></td>
                            <td>CreatePermissionAsync</td>
                            <td>Yeni izin oluÅŸturur</td>
                            <td>Task&lt;Permission&gt;</td>
                        </tr>
                        <tr>
                            <td>UpdatePermissionAsync</td>
                            <td>Ä°zin bilgilerini gÃ¼nceller</td>
                            <td>Task&lt;Permission&gt;</td>
                        </tr>
                        <tr>
                            <td>AssignPermissionToRoleAsync</td>
                            <td>Role izin atar</td>
                            <td>Task&lt;bool&gt;</td>
                        </tr>
                        <tr>
                            <td>RemovePermissionFromRoleAsync</td>
                            <td>Rolden izin kaldÄ±rÄ±r</td>
                            <td>Task&lt;bool&gt;</td>
                        </tr>
                        <tr>
                            <td>GetPermissionsByModuleAsync</td>
                            <td>ModÃ¼le gÃ¶re izinleri getirir</td>
                            <td>Task&lt;List&lt;Permission&gt;&gt;</td>
                        </tr>
                        <tr>
                            <td>GetRolePermissionsAsync</td>
                            <td>RolÃ¼n izinlerini getirir</td>
                            <td>Task&lt;List&lt;Permission&gt;&gt;</td>
                        </tr>
                        <tr>
                            <td>UserHasPermissionAsync</td>
                            <td>KullanÄ±cÄ±nÄ±n izni var mÄ± kontrol eder</td>
                            <td>Task&lt;bool&gt;</td>
                        </tr>
                        
                        <tr>
                            <td rowspan="4"><strong>IUserHierarchyService</strong></td>
                            <td>CreateHierarchyAsync</td>
                            <td>KullanÄ±cÄ± hiyerarÅŸisi oluÅŸturur</td>
                            <td>Task&lt;UserHierarchy&gt;</td>
                        </tr>
                        <tr>
                            <td>GetChildUsersAsync</td>
                            <td>Alt kullanÄ±cÄ±larÄ± getirir</td>
                            <td>Task&lt;List&lt;User&gt;&gt;</td>
                        </tr>
                        <tr>
                            <td>GetParentUserAsync</td>
                            <td>Ãœst kullanÄ±cÄ±yÄ± getirir</td>
                            <td>Task&lt;User&gt;</td>
                        </tr>
                        <tr>
                            <td>IsUserChildOfAsync</td>
                            <td>HiyerarÅŸi iliÅŸkisini kontrol eder</td>
                            <td>Task&lt;bool&gt;</td>
                        </tr>
                        
                        <tr>
                            <td rowspan="4"><strong>IDiscountAuthorityService</strong></td>
                            <td>CreateAuthorityAsync</td>
                            <td>Ä°ndirim yetkisi tanÄ±mlar</td>
                            <td>Task&lt;DiscountAuthority&gt;</td>
                        </tr>
                        <tr>
                            <td>UpdateAuthorityAsync</td>
                            <td>Ä°ndirim yetkisini gÃ¼nceller</td>
                            <td>Task&lt;DiscountAuthority&gt;</td>
                        </tr>
                        <tr>
                            <td>GetUserDiscountAuthorityAsync</td>
                            <td>KullanÄ±cÄ±nÄ±n indirim yetkisini getirir</td>
                            <td>Task&lt;DiscountAuthority&gt;</td>
                        </tr>
                        <tr>
                            <td>CanUserApplyDiscountAsync</td>
                            <td>Ä°ndirim uygulayabilir mi kontrol eder</td>
                            <td>Task&lt;bool&gt;</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section>
                <h2>âš¡ Dependency Injection Kurulumu</h2>
                
                <h3>Program.cs / Startup.cs</h3>
                <pre><code><span class="comment">// Servis kayÄ±tlarÄ±</span>
builder.Services.AddScoped&lt;IUserService, UserService&gt;();
builder.Services.AddScoped&lt;IRoleService, RoleService&gt;();
builder.Services.AddScoped&lt;IPermissionService, PermissionService&gt;();
builder.Services.AddScoped&lt;IUserHierarchyService, UserHierarchyService&gt;();
builder.Services.AddScoped&lt;IDiscountAuthorityService, DiscountAuthorityService&gt;();</code></pre>

                <h3>Constructor Injection KullanÄ±mÄ±</h3>
                <pre><code><span class="comment">// Web API Controller</span>
<span class="keyword">public class</span> <span class="type">UserController</span> : ControllerBase
{
    <span class="keyword">private readonly</span> IUserService _userService;
    <span class="keyword">private readonly</span> IRoleService _roleService;
    <span class="keyword">private readonly</span> IPermissionService _permissionService;
    
    <span class="keyword">public</span> UserController(
        IUserService userService,
        IRoleService roleService,
        IPermissionService permissionService)
    {
        _userService = userService;
        _roleService = roleService;
        _permissionService = permissionService;
    }
}

<span class="comment">// Blazor Component</span>
@inject IUserService UserService
@inject IRoleService RoleService
@inject IPermissionService PermissionService

<span class="comment">// WinForms (Manual DI Container kullanarak)</span>
<span class="keyword">public class</span> <span class="type">UserForm</span> : Form
{
    <span class="keyword">private readonly</span> IUserService _userService;
    
    <span class="keyword">public</span> UserForm(IUserService userService)
    {
        _userService = userService;
        InitializeComponent();
    }
}</code></pre>
            </section>

            <section>
                <h2>ğŸ”’ GÃ¼venlik ve En Ä°yi Pratikler</h2>
                
                <div class="warning">
                    <h4>1. Soft Delete KullanÄ±mÄ±</h4>
                    <p>TÃ¼m silme iÅŸlemleri soft delete olarak yapÄ±lÄ±r. Hard delete iÃ§in EntityBase'deki IsHardDelete property'si true yapÄ±lmalÄ±dÄ±r.</p>
                    <pre><code><span class="keyword">var</span> entity = <span class="keyword">await</span> _context.Users.FindAsync(userId);
entity.IsHardDelete = <span class="keyword">true</span>; <span class="comment">// Hard delete iÃ§in</span>
_context.Users.Remove(entity);
<span class="keyword">await</span> _context.SaveChangesAsync();</code></pre>
                </div>

                <div class="warning">
                    <h4>2. Audit Trail</h4>
                    <p>Her iÅŸlemde CreatedBy, UpdatedBy, DeletedBy alanlarÄ± otomatik gÃ¼ncellenir. Bu sayede kim ne yaptÄ± takibi yapÄ±labilir.</p>
                </div>

                <div class="warning">
                    <h4>3. Query Filter</h4>
                    <p>DbContext'te global query filter tanÄ±mlÄ±dÄ±r. Soft delete edilmiÅŸ kayÄ±tlar otomatik filtrelenir. Soft delete edilmiÅŸ kayÄ±tlarÄ± gÃ¶rmek iÃ§in:</p>
                    <pre><code><span class="keyword">var</span> allUsers = <span class="keyword">await</span> _context.Users
    .IgnoreQueryFilters()
    .ToListAsync();</code></pre>
                </div>

                <div class="note">
                    <h4>4. Async/Await KullanÄ±mÄ±</h4>
                    <p>TÃ¼m servis metodlarÄ± asenkron olarak tasarlanmÄ±ÅŸtÄ±r. Mutlaka await kullanarak Ã§aÄŸÄ±rÄ±n.</p>
                </div>

                <div class="note">
                    <h4>5. Error Handling</h4>
                    <p>IdentityResult dÃ¶nen metodlarda mutlaka Succeeded kontrolÃ¼ yapÄ±n ve Errors koleksiyonunu kontrol edin.</p>
                </div>
            </section>
        </main>
        
        <footer>
            <p>&copy; 2025 Ã–dÃ¼yo CRM - Servis KatmanÄ± KullanÄ±m DokÃ¼mantasyonu</p>
        </footer>
    </div>

    <script>
        function showPlatform(section, platform) {
            // TÃ¼m tab'larÄ± pasif yap
            const tabs = document.querySelectorAll(`#${section} .platform-tab`);
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // TÃ¼m iÃ§erikleri gizle
            const contents = document.querySelectorAll(`[id^="${section}-"]`);
            contents.forEach(content => content.classList.remove('active'));
            
            // SeÃ§ili tab ve iÃ§eriÄŸi aktif yap
            event.target.classList.add('active');
            document.getElementById(`${section}-${platform}`).classList.add('active');
        }
    </script>
</body>
</html>